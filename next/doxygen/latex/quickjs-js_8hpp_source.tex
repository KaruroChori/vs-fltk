\doxysection{quickjs-\/js.hpp}
\hypertarget{quickjs-js_8hpp_source}{}\label{quickjs-js_8hpp_source}\index{include/pipelines/quickjs-\/js.hpp@{include/pipelines/quickjs-\/js.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#if\ VS\_USE\_QJS}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <ui.hpp>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <quickjs.h>}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <pugixml.hpp>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}globals.hpp"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}commons.hpp"{}}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{comment}{//TODO:\ restructure\ following\ changes\ in\ the\ tcc\ interface}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }vs\{}
\DoxyCodeLine{00016\ \textcolor{keyword}{namespace\ }pipelines\{}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{void}\ qjs\_error\_func\_xml(\textcolor{keyword}{const}\ pugi::xml\_node\&\ env,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ msg);}
\DoxyCodeLine{00019\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{void}\ qjs\_log\_symbol\_func\_xml(\textcolor{keyword}{const}\ pugi::xml\_node\&\ env,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ msg,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ name);}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{comment}{/*}}
\DoxyCodeLine{00022\ \textcolor{comment}{struct\ jsctx\{}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ \ \ \ private:}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ \ \ \ \ \ \ \ JSContext*\ data;}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ \ \ \ public:}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ \ \ \ \ \ \ \ jsctx()\{}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ data=JS\_NewContext();}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{00029\ \textcolor{comment}{\};}}
\DoxyCodeLine{00030\ \textcolor{comment}{*/}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{struct\ }quickjs\_t\{}
\DoxyCodeLine{00033\ \ \ \ \ JSContext*\ ctx;}
\DoxyCodeLine{00034\ \ \ \ \ std::vector<std::tuple<std::string,symbol\_type\_t,JSValue>>\ handles;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{operator}\ JSContext*\ ()\{\textcolor{keywordflow}{return}\ ctx;\}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ quickjs\_t(JSRuntime*\ rt);}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{virtual}\ \string~quickjs\_t()\{}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\&\ i:\ handles)\{JS\_FreeValue(ctx,\ std::get<2>(i));\}}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ JS\_FreeContext(ctx);}
\DoxyCodeLine{00043\ \ \ \ \ \}}
\DoxyCodeLine{00044\ \};}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{keyword}{extern}\ std::shared\_ptr<quickjs\_t>\ qjs\_js\_pipeline(global\_ctx\_t\&\ globals,\ \textcolor{keywordtype}{bool}\ is\_runtime,\ \mbox{\hyperlink{classvs_1_1ui__base}{vs::ui\_base}}*\ obj,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ src,\ \textcolor{keywordtype}{void}*\ ctx,\ \textcolor{keywordtype}{void}(*error\_fn)(\textcolor{keywordtype}{void}*,\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*),\ link\_with\_t\ link\_with);}
\DoxyCodeLine{00047\ \textcolor{keyword}{extern}\ std::shared\_ptr<smap<symbol\_t>>\ qjs\_js\_pipeline\_apply(\textcolor{keyword}{const}\ std::shared\_ptr<quickjs\_t>\&\ script,\mbox{\hyperlink{classvs_1_1ui__base}{vs::ui\_base}}*\ obj,\textcolor{keywordtype}{void}*\ ctx,\textcolor{keywordtype}{void}(*register\_fn)(\textcolor{keywordtype}{void}*,\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*));}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{keyword}{inline}\ std::shared\_ptr<quickjs\_t>\ qjs\_js\_pipeline\_xml(global\_ctx\_t\&\ globals,\ \textcolor{keywordtype}{bool}\ is\_runtime,\ \mbox{\hyperlink{classvs_1_1ui__base}{vs::ui\_base}}*\ obj,\ pugi::xml\_node\&\ ctx,\ link\_with\_t\ link\_with)\{}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordflow}{return}\ qjs\_js\_pipeline(globals,is\_runtime,obj,ctx.text().as\_string(),\&ctx,(\textcolor{keywordtype}{void}(*)(\textcolor{keywordtype}{void}*,\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*))qjs\_error\_func\_xml,link\_with);}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \}}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
