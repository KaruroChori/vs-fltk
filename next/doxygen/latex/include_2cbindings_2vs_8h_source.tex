\doxysection{vs.\+h}
\hypertarget{include_2cbindings_2vs_8h_source}{}\label{include_2cbindings_2vs_8h_source}\index{include/cbindings/vs.h@{include/cbindings/vs.h}}
\mbox{\hyperlink{include_2cbindings_2vs_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00014\ \textcolor{comment}{/*}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ \ \ \ vs-\/fltk\ is\ a\ library\ meant\ to\ be\ used\ with\ its\ C++\ interface.\ \ }}
\DoxyCodeLine{00016\ \textcolor{comment}{\ \ \ \ Only\ a\ subset\ of\ its\ functionality\ is\ exposed\ with\ proper\ C\ bindings.\ \ }}
\DoxyCodeLine{00017\ \textcolor{comment}{\ \ \ \ Basically,\ what\ is\ needed\ to\ compile\ XML\ components\ into\ C,\ run\ them,\ }}
\DoxyCodeLine{00018\ \textcolor{comment}{\ \ \ \ exposing\ the\ limited\ runtime\ DOM-\/like\ structure,\ resolving\ paths\ and\ little\ more.}}
\DoxyCodeLine{00019\ \textcolor{comment}{*/}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <stddef.h>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#ifdef\ \_\_cplusplus}}
\DoxyCodeLine{00023\ \textcolor{keyword}{extern}\ \textcolor{stringliteral}{"{}C"{}}\{}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{typedef}\ \textcolor{keywordtype}{void}\ vs\_frame;}
\DoxyCodeLine{00027\ \textcolor{keyword}{typedef}\ \textcolor{keywordtype}{void}\ vs\_node;\ \ \ \textcolor{comment}{//ui\_base}}
\DoxyCodeLine{00028\ \textcolor{keyword}{typedef}\ \textcolor{keywordtype}{void}\ vs\_opaque\_script;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{enum}\ vs\_symbol\_type\_t\{}
\DoxyCodeLine{00031\ \ \ VS\_SYMBOL\_TYPE\_VOID,\ }
\DoxyCodeLine{00032\ \ \ VS\_SYMBOL\_TYPE\_UNKNOWN,\ }
\DoxyCodeLine{00033\ \ \ VS\_SYMBOL\_TYPE\_CALLBACK,\ }
\DoxyCodeLine{00034\ \ \ VS\_SYMBOL\_TYPE\_DRAW,\ }
\DoxyCodeLine{00035\ \ \ VS\_SYMBOL\_TYPE\_SETTER,\ }
\DoxyCodeLine{00036\ \ \ VS\_SYMBOL\_TYPE\_GETTER,\ }
\DoxyCodeLine{00037\ \ \ VS\_SYMBOL\_TYPE\_DISPATCHER,}
\DoxyCodeLine{00038\ \ \ VS\_SYMBOL\_TYPE\_TEST}
\DoxyCodeLine{00039\ \};}
\DoxyCodeLine{00040\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ vs\_symbol\_type\_t\ vs\_symbol\_type\_t;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{keyword}{enum}\ vs\_symbol\_mode\_t\{}
\DoxyCodeLine{00043\ \ \ VS\_SYMBOL\_MODE\_AUTO,\ }
\DoxyCodeLine{00044\ \ \ VS\_SYMBOL\_MODE\_NATIVE,\ }
\DoxyCodeLine{00045\ \ \ VS\_SYMBOL\_MODE\_QUICKJS,\ }
\DoxyCodeLine{00046\ \ \ VS\_SYMBOL\_MODE\_WASM,}
\DoxyCodeLine{00047\ \ \ VS\_SYMBOL\_MODE\_EXTERNAL,}
\DoxyCodeLine{00048\ \ \ VS\_SYMBOL\_MODE\_LUA,}
\DoxyCodeLine{00049\ \ \ VS\_SYMBOL\_MODE\_RISCV}
\DoxyCodeLine{00050\ \};}
\DoxyCodeLine{00051\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ vs\_symbol\_mode\_t\ vs\_symbol\_mode\_t;}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structvs__symbol__t}{vs\_symbol\_t}}\{}
\DoxyCodeLine{00055\ \ \ \textcolor{keyword}{enum}\ vs\_symbol\_mode\_t\ mode:3;}
\DoxyCodeLine{00056\ \ \ \textcolor{keyword}{enum}\ vs\_symbol\_type\_t\ type:5;}
\DoxyCodeLine{00057\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ symbol;}
\DoxyCodeLine{00058\ \};}
\DoxyCodeLine{00059\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structvs__symbol__t}{vs\_symbol\_t}}\ \mbox{\hyperlink{structvs__symbol__t}{vs\_symbol\_t}};}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{comment}{//TODO:\ Very\ bad\ packing.\ Fix\ it\ at\ some\ point}}
\DoxyCodeLine{00062\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structvs__symbol__ret__t}{vs\_symbol\_ret\_t}}\{}
\DoxyCodeLine{00063\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structvs__symbol__t}{vs\_symbol\_t}}\ symbol;}
\DoxyCodeLine{00064\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structvs__symbol__t}{vs\_symbol\_t}}\ ctx\_apply;}
\DoxyCodeLine{00065\ \ \ \textcolor{keyword}{const}\ vs\_frame*\ found\_at;}
\DoxyCodeLine{00066\ \};}
\DoxyCodeLine{00067\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structvs__symbol__ret__t}{vs\_symbol\_ret\_t}}\ \mbox{\hyperlink{structvs__symbol__ret__t}{vs\_symbol\_ret\_t}};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{keyword}{extern}\ \mbox{\hyperlink{structvs__symbol__t}{vs\_symbol\_t}}\ vs\_symbol\_null;}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \textcolor{keyword}{enum}\ vs\_frame\_type\_t\{}
\DoxyCodeLine{00072\ \ \ VS\_FRAME\_TYPE\_SLOT\_CONTAINER,\ \ \ \textcolor{comment}{//Stop\ any\ request\ from\ moving\ in\ between.}}
\DoxyCodeLine{00073\ \ \ VS\_FRAME\_TYPE\_CONTAINER,\ \ \ \ \ \ \ \ \textcolor{comment}{//Any\ bottom\ up\ request\ will\ stop\ here.}}
\DoxyCodeLine{00074\ \ \ VS\_FRAME\_TYPE\_SLOT,\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Any\ top\ down\ request\ will\ stop\ here.}}
\DoxyCodeLine{00075\ \ \ VS\_FRAME\_TYPE\_LEAF,\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//No\ children\ stored\ in\ here\ (but\ symbols\ are\ fine).\ Go\ to\ parent.}}
\DoxyCodeLine{00076\ \ \ VS\_FRAME\_TYPE\_NODE,\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//A\ namespace\ without\ constraints\ on\ moving\ in\ and\ out}}
\DoxyCodeLine{00077\ \};}
\DoxyCodeLine{00078\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ vs\_frame\_type\_t\ vs\_frame\_type\_t;}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \textcolor{keyword}{enum}\ vs\_frame\_access\_t\{}
\DoxyCodeLine{00081\ \ \ VS\_NODE\_PUBLIC,}
\DoxyCodeLine{00082\ \ \ VS\_NODE\_PRIVATE,}
\DoxyCodeLine{00083\ \};}
\DoxyCodeLine{00084\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ vs\_frame\_access\_t\ vs\_frame\_access\_t;}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \textcolor{keyword}{enum}\ vs\_component\_t\{}
\DoxyCodeLine{00087\ \ \ \ \ VS\_COMPONENT\_NONE,}
\DoxyCodeLine{00088\ \ \ \ \ VS\_COMPONENT\_VS,}
\DoxyCodeLine{00089\ \ \ \ \ VS\_COMPONENT\_XML,}
\DoxyCodeLine{00090\ \ \ \ \ VS\_COMPONENT\_LIB,}
\DoxyCodeLine{00091\ \ \ \ \ VS\_COMPONENT\_WASM,}
\DoxyCodeLine{00092\ \ \ \ \ VS\_COMPONENT\_RISCV,}
\DoxyCodeLine{00093\ \ \ \ \ VS\_COMPONENT\_CNATIVE,}
\DoxyCodeLine{00094\ \ \ \ \ VS\_COMPONENT\_MARKDOWN,}
\DoxyCodeLine{00095\ \};}
\DoxyCodeLine{00096\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ vs\_component\_t\ vs\_component\_t;}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \textcolor{keyword}{typedef}\ vs\_symbol\_mode\_t\ vs\_frame\_mode\_t;}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \textcolor{preprocessor}{\#if\ \_\_has\_include("{}./components.autogen.h"{})}}
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}./components.autogen.h"{}}}
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \textcolor{keywordtype}{void}\ vs\_hello\_world();}
\DoxyCodeLine{00105\ \textcolor{keywordtype}{void}\ vs\_debug(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ k,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ v);}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \textcolor{keywordtype}{void}\ vs\_node\_name\_set(vs\_node*,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*);}
\DoxyCodeLine{00109\ \textcolor{keywordtype}{void}\ vs\_node\_frame\_mode\_set(vs\_node*,\ vs\_frame\_mode\_t);}
\DoxyCodeLine{00110\ \textcolor{keywordtype}{void}\ vs\_node\_frame\_type\_set(vs\_node*,\ vs\_frame\_type\_t);}
\DoxyCodeLine{00111\ \textcolor{keywordtype}{void}\ vs\_node\_frame\_access\_set(vs\_node*,\ vs\_frame\_access\_t);}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \textcolor{keywordtype}{void}\ vs\_node\_frame\_new(vs\_node*,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ name,\ vs\_frame\_mode\_t\ mode);}
\DoxyCodeLine{00114\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ vs\_node\_class\_get(\textcolor{keyword}{const}\ vs\_node*);}
\DoxyCodeLine{00115\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ vs\_node\_name\_get(\textcolor{keyword}{const}\ vs\_node*);}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \textcolor{keywordtype}{void}\ vs\_node\_getter\_use(\textcolor{keyword}{const}\ \mbox{\hyperlink{structvs__symbol__ret__t}{vs\_symbol\_ret\_t}}*\ sym,\ \textcolor{keywordtype}{void}\ **\ value);}
\DoxyCodeLine{00118\ \textcolor{keywordtype}{void}\ vs\_node\_setter\_use(\textcolor{keyword}{const}\ \mbox{\hyperlink{structvs__symbol__ret__t}{vs\_symbol\_ret\_t}}*\ sym,\ \textcolor{keywordtype}{void}\ *\ value);}
\DoxyCodeLine{00119\ \textcolor{keywordtype}{void}\ vs\_node\_callback\_use(\textcolor{keyword}{const}\ \mbox{\hyperlink{structvs__symbol__ret__t}{vs\_symbol\_ret\_t}}*\ sym,\ vs\_node\ *\ value);}
\DoxyCodeLine{00120\ \textcolor{keywordtype}{void}\ vs\_node\_test\_use(\textcolor{keyword}{const}\ \mbox{\hyperlink{structvs__symbol__ret__t}{vs\_symbol\_ret\_t}}*\ sym);}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \textcolor{comment}{/*}}
\DoxyCodeLine{00123\ \textcolor{comment}{void\ vs\_node\_localscript\_attach(const\ vs\_opaque\_script*\ ref);}}
\DoxyCodeLine{00124\ \textcolor{comment}{void\ vs\_node\_modulecript\_attach(const\ vs\_opaque\_script*\ ref);}}
\DoxyCodeLine{00125\ \textcolor{comment}{}}
\DoxyCodeLine{00126\ \textcolor{comment}{//Resolve\ the\ frame,\ always\ looking\ at\ the\ parent\ and\ not\ self.}}
\DoxyCodeLine{00127\ \textcolor{comment}{frame*\ resolve\_frame()\ \ const;}}
\DoxyCodeLine{00128\ \textcolor{comment}{//Resolve\ the\ namespace,\ basically\ the\ first\ parent\ which\ is\ not\ "{}transparent"{}.}}
\DoxyCodeLine{00129\ \textcolor{comment}{frame*\ resolve\_namespace()\ const;}}
\DoxyCodeLine{00130\ \textcolor{comment}{symbol\_ret\_t\ resolve\_symbol(const\ char*\ str)\ const;}}
\DoxyCodeLine{00131\ \textcolor{comment}{const\ ui\_base*\ resolve\_name(const\ char\ *\ str)\ const;}}
\DoxyCodeLine{00132\ \textcolor{comment}{const\ ui\_base*\ resolve\_name\_path(const\ char\ *\ str)\ const;}}
\DoxyCodeLine{00133\ \textcolor{comment}{}}
\DoxyCodeLine{00134\ \textcolor{comment}{virtual\ int\ get\_computed(const\ char*\ prop,\ const\ char\ **\ value)\ =\ 0;}}
\DoxyCodeLine{00135\ \textcolor{comment}{virtual\ int\ apply\_prop(const\ char*\ prop,\ const\ char\ *\ value)\ =\ 0;}}
\DoxyCodeLine{00136\ \textcolor{comment}{void\ refresh\_style(const\ char*\ local\_mixins="{}"{});}}
\DoxyCodeLine{00137\ \textcolor{comment}{*/}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \textcolor{comment}{/*}}
\DoxyCodeLine{00140\ \textcolor{comment}{extern\ vs\_ui\_base\ vs\_\_ns\_component\_new(vs\_ui\_base*\ parent);}}
\DoxyCodeLine{00141\ \textcolor{comment}{extern\ int\ vs\_\_ns\_component\_delete();}}
\DoxyCodeLine{00142\ \textcolor{comment}{}}
\DoxyCodeLine{00143\ \textcolor{comment}{}}
\DoxyCodeLine{00144\ \textcolor{comment}{//void\ register\_symbol(const\ char*\ name,\ symbol\_t\ value);}}
\DoxyCodeLine{00145\ \textcolor{comment}{//symbol\_t\ get\_symbol(const\ char*\ name);}}
\DoxyCodeLine{00146\ \textcolor{comment}{//void\ unregister\_symbol(const\ char*\ name);}}
\DoxyCodeLine{00147\ \textcolor{comment}{//void\ reset\_symbols();}}
\DoxyCodeLine{00148\ \textcolor{comment}{//void\ set\_dispatcher(symbol\_t\ value);}}
\DoxyCodeLine{00149\ \textcolor{comment}{}}
\DoxyCodeLine{00150\ \textcolor{comment}{}}
\DoxyCodeLine{00151\ \textcolor{comment}{//Add\ mixin}}
\DoxyCodeLine{00152\ \textcolor{comment}{void\ add\_mixin(const\ char*\ name,\ const\ smap<std::string>\&\ ref);}}
\DoxyCodeLine{00153\ \textcolor{comment}{}}
\DoxyCodeLine{00154\ \textcolor{comment}{//Resolve\ a\ mixin\ based\ on\ its\ name}}
\DoxyCodeLine{00155\ \textcolor{comment}{std::pair<const\ smap<std::string>*,const\ frame*>\ resolve\_mixin(const\ char*\ name)\ const;}}
\DoxyCodeLine{00156\ \textcolor{comment}{}}
\DoxyCodeLine{00157\ \textcolor{comment}{//Compile\ a\ single\ prop\ based\ on\ a\ mixin\ definition}}
\DoxyCodeLine{00158\ \textcolor{comment}{const\ char*\ eval\_prop(const\ char*\ prop,\ const\ char*\ mixins[])\ const;}}
\DoxyCodeLine{00159\ \textcolor{comment}{}}
\DoxyCodeLine{00160\ \textcolor{comment}{//Generate\ a\ mixin\ map\ based\ on\ a\ list\ of\ mixins}}
\DoxyCodeLine{00161\ \textcolor{comment}{smap<std::string>\ compile\_mixins(const\ char*\ mixins\_list)\ const;}}
\DoxyCodeLine{00162\ \textcolor{comment}{}}
\DoxyCodeLine{00163\ \textcolor{comment}{inline\ Fl\_Widget\&\ widget()\{return\ *\_widget;\}}}
\DoxyCodeLine{00164\ \textcolor{comment}{inline\ const\ Fl\_Widget\&\ widget()const\{return\ *\_widget;\}}}
\DoxyCodeLine{00165\ \textcolor{comment}{}}
\DoxyCodeLine{00166\ \textcolor{comment}{//TODO:\ these\ constraints\ should\ be\ relaxed\ to\ support\ more\ general\ reparenting.}}
\DoxyCodeLine{00167\ \textcolor{comment}{//However\ this\ is\ not\ planned\ right\ now,\ and\ reparent\_frame\ is\ just\ a\ fix\ to\ the\ problem\ of\ app\ not\ being\ a\ widget.}}
\DoxyCodeLine{00168\ \textcolor{comment}{inline\ void\ reparent\_frame(ui\_base*\ newparent)\{}}
\DoxyCodeLine{00169\ \textcolor{comment}{\ \ \ \ if(local\_frame!=nullptr\ \&\&\ local\_frame-\/>parent==nullptr\ \&\&\ newparent!=nullptr\ \&\&\ newparent-\/>local\_frame!=nullptr)\{}}
\DoxyCodeLine{00170\ \textcolor{comment}{\ \ \ \ local\_frame-\/>parent=newparent-\/>local\_frame;}}
\DoxyCodeLine{00171\ \textcolor{comment}{\ \ \ \ newparent-\/>local\_frame-\/>children.insert\_or\_assign(local\_frame-\/>name,local\_frame);}}
\DoxyCodeLine{00172\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00173\ \textcolor{comment}{\}}}
\DoxyCodeLine{00174\ \textcolor{comment}{}}
\DoxyCodeLine{00175\ \textcolor{comment}{}}
\DoxyCodeLine{00176\ \textcolor{comment}{}}
\DoxyCodeLine{00177\ \textcolor{comment}{void\ path(std::stringstream\&\ dst,\ bool\ scoped\ =\ true)\ const;}}
\DoxyCodeLine{00178\ \textcolor{comment}{}}
\DoxyCodeLine{00179\ \textcolor{comment}{}}
\DoxyCodeLine{00180\ \textcolor{comment}{}}
\DoxyCodeLine{00181\ \textcolor{comment}{}}
\DoxyCodeLine{00182\ \textcolor{comment}{}}
\DoxyCodeLine{00183\ \textcolor{comment}{smap<std::string>\ compute\_refresh\_style(const\ char*\ local\_mixins="{}"{});}}
\DoxyCodeLine{00184\ \textcolor{comment}{*/}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \textcolor{comment}{//TODO:\ expose\ xml\ parser\ }}
\DoxyCodeLine{00187\ \textcolor{comment}{//TODO:\ expose\ policy\ queries}}
\DoxyCodeLine{00188\ \textcolor{comment}{//TODO:\ expose\ path\ resolver}}
\DoxyCodeLine{00189\ \textcolor{comment}{//TODO:\ expose\ cache\ model}}
\DoxyCodeLine{00190\ \textcolor{comment}{//TODO:\ expose\ script\ compilers/interpreters}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \textcolor{preprocessor}{\#ifdef\ \_\_cplusplus}}
\DoxyCodeLine{00193\ \}}
\DoxyCodeLine{00194\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
